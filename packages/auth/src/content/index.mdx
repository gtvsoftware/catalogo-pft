# @terraviva/auth

Utilit√°rio para integra√ß√£o de autentica√ß√£o Terra Viva em aplica√ß√µes front-end baseadas em Next.js.
Este pacote faz parte do reposit√≥rio [gtvsoftware/lib-auth](https://github.com/gtvsoftware/lib-auth) e deve ser instalado como **subm√≥dulo Git** e gerenciado com **pnpm workspaces**.

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## üöÄ In√≠cio R√°pido

### Instala√ß√£o

Adicione o reposit√≥rio como **subm√≥dulo** dentro do seu projeto:

```bash
git submodule add https://github.com/gtvsoftware/lib-auth.git packages/lib-auth
```

Depois configure o `pnpm-workspace.yaml` do seu monorepo para incluir o pacote:

```yaml
packages:
  - "apps/*"
  - "packages/*"
```

E rode a instala√ß√£o:

```bash
pnpm install
```

Agora o pacote `@terraviva/auth` estar√° dispon√≠vel para importa√ß√£o dentro do workspace.

### Configura√ß√£o B√°sica

1. **Configure suas vari√°veis de ambiente:**

```env
NEXT_PUBLIC_APP_URL=http://local.dev.terraviva
AUTH_URL=http://conta.dev.terraviva/api/auth
AUTH_SECRET=sua-nextauth-secret
AUTH_ISSUER_URL=http://10.0.0.28:8080/realms/terraviva
AUTH_CLIENT_ID=seu-client-id
AUTH_CLIENT_SECRET=seu-client-secret
```

2. **Crie a rota de autentica√ß√£o:**

Crie o arquivo `src/app/api/[...auth]/route.ts`:

```typescript
'use server'

import { handler } from "@terraviva/auth";

export { handler as GET, handler as POST };
```

3. **Adicione o AuthProvider ao seu layout:**

```tsx
import { AuthProvider } from "@terraviva/auth"

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="pt-BR">
      <body>
        <AuthProvider>{children}</AuthProvider>
      </body>
    </html>
  )
}
```

## Funcionalidades

* üîê **Integra√ß√£o com NextAuth.js** ‚Äì Constru√≠do sobre o NextAuth.js v5
* üéØ **Suporte a Keycloak** ‚Äì Provider pronto para uso com Keycloak
* ‚öõÔ∏è **Componentes React** ‚Äì P√°ginas e providers de autentica√ß√£o pr√©-constru√≠dos
* ÔøΩ **Cliente HTTP Autenticado** ‚Äì Inst√¢ncias Axios com auth autom√°tica e refresh de tokens
* ÔøΩüé® **TypeScript** ‚Äì Suporte completo a TypeScript
* üõ°Ô∏è **Middleware** ‚Äì Utilit√°rios para proteger rotas e requisi√ß√µes
* üé£ **React Hooks** ‚Äì Inclui `useAuthSession` e outros

## Exemplo R√°pido

```tsx
import { createAxiosInstance, useAuthSession } from "@terraviva/auth"

// Criar cliente HTTP autenticado
const api = createAxiosInstance({
  baseURL: 'https://api.exemplo.com'
})

// Usar em componente
function MyComponent() {
  const { data: session } = useAuthSession()
  
  const fetchData = async () => {
    // Requisi√ß√£o com auth autom√°tica
    const response = await api.get('/dados')
    return response.data
  }
  
  return <div>Ol√°, {session?.user?.name}!</div>
}
```

## Pr√≥ximos Passos

* [Guia de Configura√ß√£o](/setup) ‚Äì Instru√ß√µes completas de configura√ß√£o
* [Componentes](/components) ‚Äì Lista de componentes React dispon√≠veis
* [Hooks](/hooks) ‚Äì Hooks React para autentica√ß√£o
* [Utilit√°rios](/utils) ‚Äì Cliente HTTP autenticado e outros utilit√°rios
* [Refer√™ncia de API](/api) ‚Äì Documenta√ß√£o completa da API
